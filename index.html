<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dota 2 Progress Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700&family=Rajdhani:wght@400;500;600;700&display=swap');
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }

        @keyframes emberGlow {
            0%, 100% { filter: brightness(1) drop-shadow(0 0 10px rgba(220, 50, 47, 0.5)); }
            50% { filter: brightness(1.2) drop-shadow(0 0 20px rgba(220, 50, 47, 0.8)); }
        }

        @keyframes warFog {
            0% { transform: translateX(0) translateY(0); }
            100% { transform: translateX(-100px) translateY(-30px); }
        }

        :root {
            --dota-black: #000000;
            --dota-dark: #0c0e0f;
            --dota-darker: #151719;
            --dota-card: #1a1d21;
            --dota-border: #2e3338;
            --dota-red: #dc322f;
            --dota-red-dark: #8b1a1a;
            --dota-gold: #d4af37;
            --dota-gold-bright: #ffd700;
            --dota-silver: #9ca3a8;
            --dota-text: #e6e6e6;
            --dota-text-dim: #7c8184;
            --radiant-green: #92a525;
            --dire-red: #c23c2a;
            --ability-blue: #108dc7;
            --mana-blue: #0596ff;
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--dota-black);
            color: var(--dota-text);
            min-height: 100vh;
            line-height: 1.6;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(220, 50, 47, 0.02) 0%, transparent 50%),
                radial-gradient(circle at 80% 50%, rgba(146, 165, 37, 0.02) 0%, transparent 50%);
            pointer-events: none;
            z-index: 1;
        }

        /* Removed the animated war fog background to reduce lag */

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 2;
        }

        header {
            text-align: center;
            padding: 40px 0;
            position: relative;
            animation: fadeIn 1s ease;
        }

        header::before {
            content: '⚔';
            position: absolute;
            left: 50%;
            top: 0;
            transform: translateX(-50%);
            font-size: 2rem;
            color: var(--dota-gold);
            opacity: 0.3;
        }

        h1 {
            font-family: 'Cinzel', serif;
            font-size: 3.5rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 10px;
            text-shadow: 
                0 0 20px rgba(220, 50, 47, 0.5),
                0 2px 4px rgba(0, 0, 0, 0.8);
            background: linear-gradient(180deg, var(--dota-gold-bright), var(--dota-gold), var(--dota-red));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
        }

        .subtitle {
            color: var(--dota-text-dim);
            font-size: 0.9rem;
            font-weight: 500;
            letter-spacing: 4px;
            text-transform: uppercase;
            margin-top: -5px;
        }

        .input-section {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        input[type="text"] {
            padding: 14px 20px;
            border: 1px solid var(--dota-border);
            background: rgba(26, 29, 33, 0.9);
            backdrop-filter: blur(10px);
            color: var(--dota-text);
            font-size: 15px;
            width: 320px;
            transition: all 0.3s ease;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 500;
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--dota-gold);
            box-shadow: 
                inset 0 0 20px rgba(212, 175, 55, 0.1),
                0 0 20px rgba(212, 175, 55, 0.2);
        }

        input[type="text"]::placeholder {
            color: var(--dota-text-dim);
            font-size: 14px;
        }

        button {
            padding: 14px 35px;
            background: linear-gradient(135deg, var(--dota-red-dark), var(--dota-red));
            color: var(--dota-text);
            border: 1px solid var(--dota-red);
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-family: 'Rajdhani', sans-serif;
            clip-path: polygon(15px 0, 100% 0, 100% calc(100% - 15px), calc(100% - 15px) 100%, 0 100%, 0 15px);
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                0 5px 20px rgba(220, 50, 47, 0.3);
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        button:hover::before {
            left: 100%;
        }

        button:hover {
            background: linear-gradient(135deg, var(--dota-red), var(--dota-gold));
            border-color: var(--dota-gold);
            transform: translateY(-2px);
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                0 10px 30px rgba(212, 175, 55, 0.4);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            margin: 0 auto 20px;
            border: 3px solid var(--dota-border);
            border-top: 3px solid var(--dota-red);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            box-shadow: 0 0 20px rgba(220, 50, 47, 0.5);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading p {
            color: var(--dota-text-dim);
            font-weight: 500;
            letter-spacing: 1px;
            text-transform: uppercase;
            font-size: 0.9rem;
        }

        .error {
            background: rgba(194, 60, 42, 0.1);
            border: 1px solid var(--dire-red);
            border-left: 4px solid var(--dire-red);
            color: #ff6b6b;
            padding: 15px 20px;
            margin: 20px auto;
            max-width: 600px;
            display: none;
            position: relative;
            backdrop-filter: blur(10px);
            clip-path: polygon(0 0, calc(100% - 15px) 0, 100% 15px, 100% 100%, 15px 100%, 0 calc(100% - 15px));
        }

        .error.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .error::before {
            content: '⚠';
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5rem;
            color: var(--dire-red);
        }

        .error {
            padding-left: 60px;
        }

        .profile-header {
            background: linear-gradient(135deg, rgba(26, 29, 33, 0.95), rgba(21, 23, 25, 0.95));
            backdrop-filter: blur(10px);
            border: 1px solid var(--dota-border);
            padding: 30px;
            margin: 30px 0;
            display: flex;
            align-items: center;
            gap: 30px;
            position: relative;
            clip-path: polygon(0 0, calc(100% - 30px) 0, 100% 30px, 100% 100%, 30px 100%, 0 calc(100% - 30px));
            animation: fadeIn 1s ease;
        }

        .profile-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--dota-gold), transparent);
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--dota-red-dark), var(--dota-red));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            position: relative;
            clip-path: polygon(25% 0%, 100% 0%, 75% 100%, 0% 100%);
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .profile-stats {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }

        .profile-stat {
            display: flex;
            flex-direction: column;
        }

        .profile-stat-label {
            color: var(--dota-text-dim);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .profile-stat-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--dota-gold);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(26, 29, 33, 0.9), rgba(21, 23, 25, 0.9));
            backdrop-filter: blur(10px);
            padding: 25px;
            border: 1px solid var(--dota-border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            clip-path: polygon(0 0, calc(100% - 15px) 0, 100% 15px, 100% 100%, 15px 100%, 0 calc(100% - 15px));
            animation: fadeIn 1s ease backwards;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: linear-gradient(180deg, var(--dota-gold), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            border-color: var(--dota-gold);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--dota-red-dark), var(--dota-red));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            margin-bottom: 15px;
            clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
        }

        .stat-label {
            color: var(--dota-text-dim);
            font-size: 0.8rem;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 600;
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--dota-text);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .chart-container {
            background: linear-gradient(135deg, rgba(26, 29, 33, 0.95), rgba(21, 23, 25, 0.95));
            backdrop-filter: blur(10px);
            border: 1px solid var(--dota-border);
            padding: 25px;
            margin: 25px 0;
            position: relative;
            clip-path: polygon(0 0, calc(100% - 20px) 0, 100% 20px, 100% 100%, 20px 100%, 0 calc(100% - 20px));
            height: 400px; /* Fixed height to prevent infinite scaling */
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--dota-gold);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .chart-canvas {
            max-height: 320px; /* Constrain canvas height */
        }

        .tabs {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin: 30px 0;
            background: rgba(26, 29, 33, 0.5);
            padding: 5px;
            backdrop-filter: blur(10px);
            border: 1px solid var(--dota-border);
        }

        .tab {
            padding: 12px 30px;
            background: transparent;
            border: 1px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.85rem;
            color: var(--dota-text-dim);
            position: relative;
        }

        .tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 2px;
            background: var(--dota-gold);
            transition: width 0.3s ease;
        }

        .tab:hover {
            color: var(--dota-text);
        }

        .tab.active {
            background: linear-gradient(135deg, rgba(220, 50, 47, 0.2), rgba(212, 175, 55, 0.1));
            border: 1px solid var(--dota-gold);
            color: var(--dota-gold);
        }

        .tab.active::after {
            width: 80%;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        .hero-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
            margin: 30px 0;
        }

        .hero-card {
            background: linear-gradient(135deg, rgba(26, 29, 33, 0.95), rgba(21, 23, 25, 0.95));
            backdrop-filter: blur(10px);
            border: 1px solid var(--dota-border);
            padding: 12px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            clip-path: polygon(0 0, calc(100% - 10px) 0, 100% 10px, 100% 100%, 10px 100%, 0 calc(100% - 10px));
        }

        .hero-card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--dota-gold), var(--dota-red));
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: -1;
        }

        .hero-card:hover::before {
            opacity: 1;
        }

        .hero-card:hover {
            transform: translateY(-5px) scale(1.05);
            border-color: var(--dota-gold);
        }

        .hero-icon {
            width: 70px;
            height: 70px;
            margin: 0 auto 8px;
            background-size: cover;
            background-position: center;
            border: 2px solid var(--dota-border);
            transition: all 0.3s ease;
        }

        .hero-card:hover .hero-icon {
            border-color: var(--dota-gold);
            filter: brightness(1.1);
        }

        .hero-name {
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 5px;
            color: var(--dota-text);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .hero-stats {
            font-size: 0.75rem;
            color: var(--dota-text-dim);
            font-weight: 500;
        }

        .hero-winrate {
            margin-top: 3px;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .hero-winrate.good {
            color: var(--radiant-green);
            text-shadow: 0 0 10px rgba(146, 165, 37, 0.5);
        }

        .hero-winrate.bad {
            color: var(--dire-red);
            text-shadow: 0 0 10px rgba(194, 60, 42, 0.5);
        }

        .match-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 30px 0;
        }

        .match-card {
            background: linear-gradient(135deg, rgba(26, 29, 33, 0.95), rgba(21, 23, 25, 0.95));
            backdrop-filter: blur(10px);
            border: 1px solid var(--dota-border);
            padding: 10px;
            display: flex;
            align-items: stretch;
            gap: 10px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            clip-path: polygon(0 0, calc(100% - 8px) 0, 100% 8px, 100% 100%, 8px 100%, 0 calc(100% - 8px));
            animation: slideIn 0.5s ease backwards;
            min-height: 80px;
        }

        .match-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 2px;
        }

        .match-card.win::before {
            background: var(--radiant-green);
        }

        .match-card.loss::before {
            background: var(--dire-red);
        }

        .match-card:hover {
            transform: translateX(2px);
            border-color: var(--dota-gold);
            box-shadow: -3px 0 15px rgba(0, 0, 0, 0.5);
        }

        .match-hero {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-width: 60px;
        }

        .match-hero-icon {
            width: 42px;
            height: 42px;
            background-size: cover;
            background-position: center;
            border: 1px solid var(--dota-border);
            position: relative;
        }

        .match-card.win .match-hero-icon {
            border-color: var(--radiant-green);
            box-shadow: 0 0 8px rgba(146, 165, 37, 0.3);
        }

        .match-card.loss .match-hero-icon {
            border-color: var(--dire-red);
            box-shadow: 0 0 8px rgba(194, 60, 42, 0.3);
        }

        .match-hero-name {
            font-size: 0.6rem;
            font-weight: 600;
            text-align: center;
            color: var(--dota-text-dim);
            max-width: 60px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-top: 2px;
        }

        .match-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-width: 0;
        }

        .match-top-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }

        .match-result {
            display: inline-block;
            padding: 2px 8px;
            font-weight: 700;
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .match-result.win {
            background: var(--radiant-green);
            color: #fff;
        }

        .match-result.loss {
            background: var(--dire-red);
            color: #fff;
        }

        .match-kda {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--dota-text);
        }

        .match-kda span {
            color: var(--dota-text-dim);
            font-size: 0.9rem;
            margin: 0 2px;
        }

        .kda-ratio {
            font-size: 0.7rem;
            color: var(--dota-gold);
            margin-left: 5px;
        }

        .match-stats {
            display: flex;
            gap: 12px;
            font-size: 0.65rem;
            color: var(--dota-text-dim);
            margin-bottom: 5px;
        }

        .match-stat {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .match-stat-label {
            text-transform: uppercase;
            font-weight: 600;
        }

        .match-stat-value {
            font-weight: 700;
            color: var(--dota-gold);
        }

        .match-items-container {
            display: flex;
            gap: 2px;
            align-items: center;
        }

        .match-items-main {
            display: flex;
            gap: 2px;
        }

        .item-slot {
            width: 26px;
            height: 26px;
            background: linear-gradient(135deg, rgba(12, 14, 15, 0.9), rgba(21, 23, 25, 0.9));
            border: 1px solid var(--dota-border);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            transition: all 0.3s ease;
            position: relative;
            cursor: pointer;
        }

        .item-slot.empty {
            opacity: 0.15;
        }

        .item-slot.neutral {
            border-color: var(--dota-gold);
            margin-left: 5px;
        }

        .item-slot:hover:not(.empty) {
            transform: scale(1.4);
            border-color: var(--dota-gold);
            z-index: 10;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }

        .match-teams {
            display: flex;
            flex-direction: column;
            gap: 3px;
            min-width: 180px;
            justify-content: center;
        }

        .team-row {
            display: flex;
            gap: 2px;
            align-items: center;
        }

        .team-label {
            font-size: 0.6rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            width: 30px;
        }

        .team-row.radiant .team-label {
            color: var(--radiant-green);
        }

        .team-row.dire .team-label {
            color: var(--dire-red);
        }

        .team-hero {
            width: 24px;
            height: 24px;
            background-size: cover;
            background-position: center;
            border: 1px solid var(--dota-border);
            position: relative;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .team-hero.player {
            border: 1.5px solid var(--dota-gold);
            box-shadow: 0 0 5px rgba(212, 175, 55, 0.3);
        }

        .team-hero:hover {
            transform: scale(1.3);
            z-index: 10;
            border-color: var(--dota-gold);
        }

        .match-meta {
            text-align: right;
            min-width: 80px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            font-size: 0.65rem;
        }

        .match-duration {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--dota-text);
        }

        .match-mode {
            color: var(--dota-text-dim);
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .match-time {
            color: var(--dota-text-dim);
        }

        .match-team-score {
            font-size: 0.9rem;
            font-weight: 700;
            margin: 2px 0;
        }

        .radiant-score {
            color: var(--radiant-green);
        }

        .dire-score {
            color: var(--dire-red);
        }

        .score-separator {
            color: var(--dota-text-dim);
            margin: 0 2px;
        }

        .match-link {
            color: var(--dota-gold);
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            transition: all 0.3s ease;
        }

        .match-link:hover {
            color: var(--dota-gold-bright);
        }

        .winrate-bar {
            height: 6px;
            background: linear-gradient(90deg, var(--dota-dark), var(--dota-darker));
            overflow: hidden;
            margin-top: 10px;
            position: relative;
            border: 1px solid var(--dota-border);
        }

        .winrate-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--radiant-green), var(--dota-gold));
            transition: width 1.5s ease;
            position: relative;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }

        .rank-display {
            background: linear-gradient(135deg, rgba(26, 29, 33, 0.95), rgba(21, 23, 25, 0.95));
            backdrop-filter: blur(10px);
            border: 2px solid var(--dota-gold);
            padding: 25px;
            text-align: center;
            margin: 30px 0;
            position: relative;
            overflow: hidden;
            clip-path: polygon(0 0, calc(100% - 25px) 0, 100% 25px, 100% 100%, 25px 100%, 0 calc(100% - 25px));
            /* Removed animation to reduce lag */
        }

        .rank-display::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(212, 175, 55, 0.05) 0%, transparent 70%);
            /* Removed spinning animation to reduce lag */
        }

        .rank-medal {
            font-size: 4rem;
            margin-bottom: 10px;
            filter: drop-shadow(0 5px 15px rgba(212, 175, 55, 0.5));
            /* Removed pulsing animation to reduce lag */
        }

        .rank-title {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--dota-gold-bright), var(--dota-gold));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-family: 'Cinzel', serif;
        }

        .mmr-value {
            font-size: 1.2rem;
            color: var(--dota-text-dim);
            font-weight: 600;
            letter-spacing: 1px;
        }

        section h2 {
            font-family: 'Cinzel', serif;
            font-size: 1.8rem;
            text-align: center;
            margin: 40px 0 20px;
            color: var(--dota-gold);
            text-transform: uppercase;
            letter-spacing: 3px;
            position: relative;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        section h2::before,
        section h2::after {
            content: '';
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 100px;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--dota-gold), transparent);
        }

        section h2::before {
            left: 0;
        }

        section h2::after {
            right: 0;
        }

        @media (max-width: 768px) {
            h1 { font-size: 2.5rem; }
            .profile-header { flex-direction: column; text-align: center; }
            .match-card { 
                flex-direction: column; 
                text-align: center;
                clip-path: none;
            }
            .match-meta { text-align: center; }
            .stats-grid { grid-template-columns: 1fr; }
            .hero-grid { grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); }
            section h2::before,
            section h2::after { display: none; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>DOTA 2 TRACKER</h1>
            <p class="subtitle">Elevate Your Game</p>
        </header>

        <div class="input-section">
            <input type="text" id="steamId" placeholder="Enter Steam ID or OpenDota Player ID" />
            <button onclick="fetchData()">🚀 Load Stats</button>
            <button onclick="refreshData()" style="display: none;" id="refreshBtn">🔄 Refresh</button>
        </div>

        <div class="loading">
            <div class="loading-spinner"></div>
            <p>Summoning the Ancient's wisdom...</p>
        </div>

        <div class="error" id="error"></div>

        <div id="content" style="display: none;">
            <div class="profile-header" id="profileHeader" style="display: none;">
                <div class="profile-avatar" id="profileAvatar">👤</div>
                <div class="profile-info">
                    <div class="profile-name" id="profileName">Anonymous Hero</div>
                    <div class="profile-stats">
                        <div class="profile-stat">
                            <span class="profile-stat-label">Total Matches</span>
                            <span class="profile-stat-value" id="profileMatches">0</span>
                        </div>
                        <div class="profile-stat">
                            <span class="profile-stat-label">Win Rate</span>
                            <span class="profile-stat-value" id="profileWinrate">0%</span>
                        </div>
                        <div class="profile-stat">
                            <span class="profile-stat-label">Best Streak</span>
                            <span class="profile-stat-value" id="profileStreak">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="rank-display" id="rankDisplay" style="display: none;">
                <div class="rank-medal" id="rankMedal">🎖️</div>
                <div class="rank-title" id="rankTitle">Unranked</div>
                <div class="mmr-value" id="mmrValue">Calibrating...</div>
            </div>

            <div class="tabs">
                <div class="tab active" onclick="switchTab(event, 'overview')">Overview</div>
                <div class="tab" onclick="switchTab(event, 'heroes')">Heroes</div>
                <div class="tab" onclick="switchTab(event, 'matches')">Matches</div>
                <div class="tab" onclick="switchTab(event, 'charts')">Analytics</div>
            </div>

            <div id="overview" class="tab-content active">
                <div class="stats-grid">
                    <div class="stat-card" style="animation-delay: 0.1s;">
                        <div class="stat-icon">🏆</div>
                        <div class="stat-label">Total Matches</div>
                        <div class="stat-value" id="totalMatches">0</div>
                        <div class="stat-change positive" id="matchChange"></div>
                    </div>
                    <div class="stat-card" style="animation-delay: 0.2s;">
                        <div class="stat-icon">📈</div>
                        <div class="stat-label">Win Rate</div>
                        <div class="stat-value" id="winRate">0%</div>
                        <div class="winrate-bar">
                            <div class="winrate-fill" id="winrateFill"></div>
                        </div>
                    </div>
                    <div class="stat-card" style="animation-delay: 0.3s;">
                        <div class="stat-icon">⚔️</div>
                        <div class="stat-label">Average KDA</div>
                        <div class="stat-value" id="avgKDA">0.0</div>
                        <div class="stat-change" id="kdaChange"></div>
                    </div>
                    <div class="stat-card" style="animation-delay: 0.4s;">
                        <div class="stat-icon">🔥</div>
                        <div class="stat-label">Recent Form</div>
                        <div class="stat-value" id="recentForm">0W - 0L</div>
                    </div>
                    <div class="stat-card" style="animation-delay: 0.5s;">
                        <div class="stat-icon">💰</div>
                        <div class="stat-label">Average GPM</div>
                        <div class="stat-value" id="avgGPM">0</div>
                    </div>
                    <div class="stat-card" style="animation-delay: 0.6s;">
                        <div class="stat-icon">⭐</div>
                        <div class="stat-label">Average XPM</div>
                        <div class="stat-value" id="avgXPM">0</div>
                    </div>
                </div>
            </div>

            <div id="heroes" class="tab-content">
                <h2 style="margin: 30px 0; text-align: center; font-size: 2rem;">Your Hero Pool</h2>
                <div class="hero-grid" id="heroGrid"></div>
            </div>

            <div id="matches" class="tab-content">
                <h2 style="margin: 30px 0; text-align: center; font-size: 2rem;">Recent Battles</h2>
                <div class="match-list" id="matchList"></div>
            </div>

            <div id="charts" class="tab-content">
                <div class="chart-container">
                    <div class="chart-title">Performance Trend (Last 20 Games)</div>
                    <canvas id="performanceChart" class="chart-canvas"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">KDA Distribution</div>
                    <canvas id="kdaChart" class="chart-canvas"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Game Impact Metrics</div>
                    <canvas id="impactChart" class="chart-canvas"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://api.opendota.com/api';
        const CDN_BASE = 'https://cdn.cloudflare.steamstatic.com';
        
        let playerData = null;
        let recentMatches = [];
        let heroStats = [];
        let currentAccountId = null;

        const heroNames = {
            1: "Anti-Mage", 2: "Axe", 3: "Bane", 4: "Bloodseeker", 5: "Crystal Maiden",
            6: "Drow Ranger", 7: "Earthshaker", 8: "Juggernaut", 9: "Mirana", 10: "Morphling",
            11: "Shadow Fiend", 12: "Phantom Lancer", 13: "Puck", 14: "Pudge", 15: "Razor",
            16: "Sand King", 17: "Storm Spirit", 18: "Sven", 19: "Tiny", 20: "Vengeful Spirit",
            21: "Windranger", 22: "Zeus", 23: "Kunkka", 25: "Lina", 26: "Lion",
            27: "Shadow Shaman", 28: "Slardar", 29: "Tidehunter", 30: "Witch Doctor", 31: "Lich",
            32: "Riki", 33: "Enigma", 34: "Tinker", 35: "Sniper", 36: "Necrophos",
            37: "Warlock", 38: "Beastmaster", 39: "Queen of Pain", 40: "Venomancer", 41: "Faceless Void",
            42: "Wraith King", 43: "Death Prophet", 44: "Phantom Assassin", 45: "Pugna", 46: "Templar Assassin",
            47: "Viper", 48: "Luna", 49: "Dragon Knight", 50: "Dazzle", 51: "Clockwerk",
            52: "Leshrac", 53: "Nature's Prophet", 54: "Lifestealer", 55: "Dark Seer", 56: "Clinkz",
            57: "Omniknight", 58: "Enchantress", 59: "Huskar", 60: "Night Stalker", 61: "Broodmother",
            62: "Bounty Hunter", 63: "Weaver", 64: "Jakiro", 65: "Batrider", 66: "Chen",
            67: "Spectre", 68: "Ancient Apparition", 69: "Doom", 70: "Ursa", 71: "Spirit Breaker",
            72: "Gyrocopter", 73: "Alchemist", 74: "Invoker", 75: "Silencer", 76: "Outworld Destroyer",
            77: "Lycan", 78: "Brewmaster", 79: "Shadow Demon", 80: "Lone Druid", 81: "Chaos Knight",
            82: "Meepo", 83: "Treant Protector", 84: "Ogre Magi", 85: "Undying", 86: "Rubick",
            87: "Disruptor", 88: "Nyx Assassin", 89: "Naga Siren", 90: "Keeper of the Light", 91: "Io",
            92: "Visage", 93: "Slark", 94: "Medusa", 95: "Troll Warlord", 96: "Centaur Warrunner",
            97: "Magnus", 98: "Timbersaw", 99: "Bristleback", 100: "Tusk", 101: "Skywrath Mage",
            102: "Abaddon", 103: "Elder Titan", 104: "Legion Commander", 105: "Techies", 106: "Ember Spirit",
            107: "Earth Spirit", 108: "Underlord", 109: "Terrorblade", 110: "Phoenix", 111: "Oracle",
            112: "Winter Wyvern", 113: "Arc Warden", 114: "Monkey King", 119: "Dark Willow", 120: "Pangolier",
            121: "Grimstroke", 123: "Hoodwink", 126: "Void Spirit", 128: "Snapfire", 129: "Mars",
            135: "Dawnbreaker", 136: "Marci", 137: "Primal Beast", 138: "Muerta"
        };

        function getHeroIcon(heroId) {
            // Special mappings for heroes whose image names don't match their display names
            const heroImageMap = {
                1: 'antimage', 2: 'axe', 3: 'bane', 4: 'bloodseeker', 5: 'crystal_maiden',
                6: 'drow_ranger', 7: 'earthshaker', 8: 'juggernaut', 9: 'mirana', 10: 'morphling',
                11: 'nevermore', // Shadow Fiend
                12: 'phantom_lancer', 13: 'puck', 14: 'pudge', 15: 'razor',
                16: 'sand_king', 17: 'storm_spirit', 18: 'sven', 19: 'tiny', 20: 'vengefulspirit',
                21: 'windrunner', // Windranger
                22: 'zuus', // Zeus (with double 'u')
                23: 'kunkka', 25: 'lina', 26: 'lion',
                27: 'shadow_shaman', 28: 'slardar', 29: 'tidehunter', 30: 'witch_doctor', 31: 'lich',
                32: 'riki', 33: 'enigma', 34: 'tinker', 35: 'sniper', 36: 'necrolyte', // Necrophos
                37: 'warlock', 38: 'beastmaster', 39: 'queenofpain', 40: 'venomancer', 41: 'faceless_void',
                42: 'skeleton_king', // Wraith King
                43: 'death_prophet', 44: 'phantom_assassin', 45: 'pugna', 46: 'templar_assassin',
                47: 'viper', 48: 'luna', 49: 'dragon_knight', 50: 'dazzle', 51: 'rattletrap', // Clockwerk
                52: 'leshrac', 53: 'furion', // Nature's Prophet
                54: 'life_stealer', 55: 'dark_seer', 56: 'clinkz',
                57: 'omniknight', 58: 'enchantress', 59: 'huskar', 60: 'night_stalker', 61: 'broodmother',
                62: 'bounty_hunter', 63: 'weaver', 64: 'jakiro', 65: 'batrider', 66: 'chen',
                67: 'spectre', 68: 'ancient_apparition', 69: 'doom_bringer', // Doom
                70: 'ursa', 71: 'spirit_breaker',
                72: 'gyrocopter', 73: 'alchemist', 74: 'invoker', 75: 'silencer', 76: 'obsidian_destroyer', // Outworld Destroyer
                77: 'lycan', 78: 'brewmaster', 79: 'shadow_demon', 80: 'lone_druid', 81: 'chaos_knight',
                82: 'meepo', 83: 'treant', // Treant Protector
                84: 'ogre_magi', 85: 'undying', 86: 'rubick',
                87: 'disruptor', 88: 'nyx_assassin', 89: 'naga_siren', 90: 'keeper_of_the_light', 91: 'wisp', // Io
                92: 'visage', 93: 'slark', 94: 'medusa', 95: 'troll_warlord', 96: 'centaur',
                97: 'magnataur', // Magnus
                98: 'shredder', // Timbersaw
                99: 'bristleback', 100: 'tusk', 101: 'skywrath_mage',
                102: 'abaddon', 103: 'elder_titan', 104: 'legion_commander', 105: 'techies', 106: 'ember_spirit',
                107: 'earth_spirit', 108: 'abyssal_underlord', // Underlord
                109: 'terrorblade', 110: 'phoenix', 111: 'oracle',
                112: 'winter_wyvern', 113: 'arc_warden', 114: 'monkey_king', 119: 'dark_willow', 120: 'pangolier',
                121: 'grimstroke', 123: 'hoodwink', 126: 'void_spirit', 128: 'snapfire', 129: 'mars',
                135: 'dawnbreaker', 136: 'marci', 137: 'primal_beast', 138: 'muerta'
            };
            
            const imageName = heroImageMap[heroId];
            if (!imageName) return '';
            
            return `https://cdn.cloudflare.steamstatic.com/apps/dota2/images/dota_react/heroes/${imageName}.png`;
        }

        function getItemIcon(itemId) {
            if (!itemId || itemId === 0) return '';
            
            // Map of common item IDs to their image names
            const itemMap = {
                1: 'blink', 2: 'blades_of_attack', 3: 'broadsword', 4: 'chainmail', 
                5: 'claymore', 6: 'helm_of_iron_will', 7: 'javelin', 8: 'mithril_hammer',
                9: 'platemail', 10: 'quarterstaff', 11: 'quelling_blade', 12: 'ring_of_protection',
                13: 'gauntlets', 14: 'slippers', 15: 'mantle', 16: 'branches',
                17: 'belt_of_strength', 18: 'boots_of_elves', 19: 'robe', 20: 'circlet',
                21: 'ogre_axe', 22: 'blade_of_alacrity', 23: 'staff_of_wizardry', 24: 'ultimate_orb',
                25: 'gloves', 26: 'lifesteal', 27: 'ring_of_regen', 28: 'sobi_mask',
                29: 'boots', 30: 'gem', 31: 'cloak', 32: 'talisman_of_evasion',
                34: 'magic_stick', 36: 'magic_wand', 37: 'ghost', 38: 'clarity',
                39: 'flask', 40: 'dust', 41: 'bottle', 42: 'ward_observer',
                43: 'ward_sentry', 44: 'tango', 45: 'courier', 46: 'tpscroll',
                48: 'travel_boots', 50: 'phase_boots', 63: 'power_treads', 
                65: 'hand_of_midas', 67: 'oblivion_staff', 69: 'medallion_of_courage',
                73: 'bracer', 75: 'wraith_band', 77: 'null_talisman', 79: 'mekansm',
                81: 'vladmir', 86: 'buckler', 88: 'ring_of_basilius', 90: 'pipe',
                92: 'urn_of_shadows', 94: 'headdress', 96: 'sheepstick', 98: 'orchid',
                100: 'cyclone', 102: 'force_staff', 104: 'dagon', 106: 'necronomicon',
                108: 'ultimate_scepter', 110: 'refresher', 112: 'assault', 114: 'heart',
                116: 'black_king_bar', 117: 'aegis', 119: 'shivas_guard', 121: 'bloodstone',
                123: 'sphere', 125: 'vanguard', 127: 'blade_mail', 129: 'soul_ring',
                131: 'hood_of_defiance', 133: 'rapier', 135: 'monkey_king_bar', 137: 'radiance',
                139: 'butterfly', 141: 'greater_crit', 143: 'basher', 145: 'bfury',
                147: 'manta', 149: 'lesser_crit', 151: 'armlet', 152: 'invis_sword',
                154: 'sange_and_yasha', 156: 'satanic', 158: 'mjollnir', 160: 'skadi',
                162: 'sange', 164: 'helm_of_the_dominator', 166: 'maelstrom', 168: 'desolator',
                170: 'yasha', 172: 'mask_of_madness', 174: 'diffusal_blade', 176: 'ethereal_blade',
                178: 'soul_booster', 180: 'arcane_boots', 181: 'orb_of_venom', 185: 'ancient_janggo',
                187: 'veil_of_discord', 190: 'rod_of_atos', 206: 'rod_of_atos', 208: 'abyssal_blade',
                210: 'heavens_halberd', 212: 'ring_of_aquila', 214: 'tranquil_boots', 215: 'shadow_amulet',
                220: 'travel_boots_2', 223: 'meteor_hammer', 225: 'nullifier', 226: 'lotus_orb',
                229: 'solar_crest', 231: 'guardian_greaves', 232: 'aether_lens', 234: 'octarine_core',
                235: 'dragon_lance', 236: 'faerie_fire', 237: 'enchanted_mango', 240: 'blight_stone',
                242: 'crimson_guard', 244: 'wind_lace', 247: 'moon_shard', 249: 'silver_edge',
                250: 'bloodthorn', 252: 'echo_sabre', 254: 'glimmer_cape', 256: 'aeon_disk',
                257: 'tome_of_knowledge', 259: 'kaya', 261: 'trident', 263: 'hurricane_pike',
                265: 'infused_raindrop', 267: 'spirit_vessel', 269: 'holy_locket', 271: 'vambrace',
                273: 'kaya_and_sange', 277: 'yasha_and_kaya', 287: 'keen_optic', 288: 'grove_bow',
                289: 'quickening_charm', 290: 'philosophers_stone', 291: 'force_boots', 292: 'desolator_2',
                294: 'swift_blink', 295: 'arcane_blink', 296: 'overwhelming_blink', 297: 'aghanims_shard',
                299: 'mage_slayer', 301: 'eternal_shroud', 302: 'elixer', 304: 'faded_broach',
                306: 'paladin_sword', 309: 'stormcrafter', 311: 'penta_edged_sword', 312: 'princes_knife',
                313: 'phylactery', 317: 'recipe_armlet', 325: 'princes_knife', 326: 'spider_legs',
                328: 'possessed_mask', 330: 'witchblade', 331: 'penta_edged_sword', 334: 'imp_claw',
                335: 'flicker', 336: 'spy_gadget', 349: 'arcane_ring', 354: 'ocean_heart',
                355: 'broom_handle', 356: 'trusty_shovel', 357: 'nether_shawl', 358: 'wizard_glass',
                359: 'fluffy_hat', 360: 'clumsy_net', 361: 'enchanted_quiver', 362: 'ninja_gear',
                363: 'illusionsts_cape', 364: 'havoc_hammer', 365: 'panic_button', 366: 'apex',
                367: 'ballista', 368: 'woodland_striders', 369: 'recipe_trident', 370: 'demonicon',
                371: 'fallen_sky', 372: 'pirate_hat', 373: 'dimensional_doorway', 374: 'ex_machina',
                375: 'fae_grenade', 376: 'ceremonial_robe', 377: 'psychic_headband', 378: 'book_of_shadows',
                379: 'giants_ring', 381: 'craggy_coat', 485: 'blitz_knuckles', 533: 'witch_blade',
                534: 'wind_waker', 569: 'orb_of_corrosion', 571: 'firecrackers', 573: 'elven_tunic',
                574: 'cloak_of_flames', 575: 'venom_gland', 576: 'trickster_cloak', 577: 'ninja_gear',
                585: 'stormcrafter', 588: 'overflowing_elixir', 589: 'mysterious_hat', 593: 'fluffy_hat',
                594: 'orb_of_destruction', 596: 'falcon_blade', 597: 'mage_slayer', 598: 'unbounded_sphere',
                599: 'ring_of_tarrasque', 600: 'tiara_of_selemene', 603: 'swift_blink', 604: 'arcane_blink',
                606: 'overwhelming_blink', 608: 'harpoon', 609: 'helm_of_the_overlord', 610: 'gungir',
                611: 'ethereal_blade_2', 612: 'witch_blade', 633: 'rapier_2', 635: 'aghanims_shard',
                638: 'voodoo_mask', 640: 'quicksilver_amulet', 653: 'shadow_dagger', 655: 'parasma',
                672: 'khanda', 674: 'arcane_scout', 675: 'barricade', 676: 'harpoon', 677: 'occult_bracelet',
                678: 'tome_of_omniscience', 680: 'seeds_of_serenity', 686: 'elven_bracers', 692: 'eternal_shroud',
                725: 'aghanims_blessing', 727: 'guardian_shell', 731: 'satchel', 821: 'diadem', 
                824: 'health_potion', 825: 'magic_potion', 826: 'ambrosia', 827: 'icarus_wings',
                828: 'force_field', 829: 'boots_of_bearing', 834: 'witchbane', 835: 'gungir_2',
                836: 'force_boots', 837: 'desolator_3', 838: 'mirror_shield', 840: 'telescope',
                908: 'destination', 911: 'revenants_brooch', 931: 'satchel', 1021: 'river_painter',
                1022: 'river_painter2', 1023: 'river_painter3', 1024: 'river_painter4', 1025: 'river_painter5',
                1026: 'river_painter6', 1027: 'river_painter7', 1028: 'mutation_tombstone', 1030: 'pocket_tower',
                1032: 'pocket_roshan', 1076: 'io_arcana', 1088: 'axe_ti9_immortal', 1107: 'muerta_gun',
                1123: 'meteorite_hammer', 1157: 'samurai_tabi', 1158: 'dragon_scale', 1159: 'elixir',
                1160: 'cloak_of_rebellion', 1163: 'echo_sabre_2', 1164: 'kaya_and_trident', 1165: 'sange_and_trident',
                1168: 'yasha_and_trident', 1170: 'trident_and_tome', 1466: 'arcane_boots_2', 1806: 'aegis_roshan',
                1808: 'recipe_aghanims'
            };
            
            const imageName = itemMap[itemId];
            if (!imageName) {
                // If not in our map, try a generic approach for recipes
                if (itemId >= 317 && itemId <= 400) return 'recipe';
                return '';
            }
            
            return `https://cdn.cloudflare.steamstatic.com/apps/dota2/images/dota_react/items/${imageName}.png`;
        }

        async function fetchData() {
            const input = document.getElementById('steamId').value.trim();
            if (!input) {
                showError('Please enter your Steam ID or OpenDota player ID');
                return;
            }

            currentAccountId = convertTo32BitId(input);
            await loadData();
        }

        async function refreshData() {
            if (currentAccountId) {
                await loadData();
            }
        }

        async function loadData() {
            showLoading(true);
            hideError();

            try {
                // Fetch all data in parallel
                const [profileRes, wlRes, matchesRes, heroesRes] = await Promise.all([
                    fetch(`${API_BASE}/players/${currentAccountId}`),
                    fetch(`${API_BASE}/players/${currentAccountId}/wl`),
                    fetch(`${API_BASE}/players/${currentAccountId}/recentMatches`),
                    fetch(`${API_BASE}/players/${currentAccountId}/heroes`)
                ]);

                if (!profileRes.ok) throw new Error('Player not found');

                playerData = await profileRes.json();
                const wl = await wlRes.json();
                recentMatches = await matchesRes.json();
                heroStats = await heroesRes.json();

                if (!recentMatches || recentMatches.length === 0) {
                    throw new Error('No match data available. Make sure your profile is public.');
                }

                // Fetch full match details for items and team compositions
                // The /matches endpoint has all the item data we need
                const matchDetailsPromises = recentMatches.slice(0, 15).map(match => 
                    fetch(`${API_BASE}/matches/${match.match_id}`)
                        .then(res => res.json())
                        .catch(err => {
                            console.error(`Failed to fetch match ${match.match_id}:`, err);
                            return null;
                        })
                );
                
                const detailedMatches = await Promise.all(matchDetailsPromises);
                
                // Merge detailed data with recent matches
                recentMatches = recentMatches.map((match, index) => {
                    if (index < 15 && detailedMatches[index]) {
                        const details = detailedMatches[index];
                        // Find the player's data in the match
                        const playerData = details.players?.find(p => 
                            p.account_id == currentAccountId || 
                            p.player_slot === match.player_slot
                        );
                        
                        if (playerData) {
                            // Add item data from the detailed match
                            return {
                                ...match,
                                item_0: playerData.item_0,
                                item_1: playerData.item_1,
                                item_2: playerData.item_2,
                                item_3: playerData.item_3,
                                item_4: playerData.item_4,
                                item_5: playerData.item_5,
                                item_neutral: playerData.item_neutral,
                                backpack_0: playerData.backpack_0,
                                backpack_1: playerData.backpack_1,
                                backpack_2: playerData.backpack_2,
                                hero_damage: playerData.hero_damage,
                                hero_healing: playerData.hero_healing,
                                tower_damage: playerData.tower_damage,
                                details: details
                            };
                        }
                    }
                    return match;
                });

                displayProfile();
                displayStats(wl);
                displayRank();
                displayHeroes();
                displayMatches();
                createCharts();

                document.getElementById('content').style.display = 'block';
                document.getElementById('refreshBtn').style.display = 'inline-block';
            } catch (error) {
                showError(error.message || 'Failed to load data. Please check your Steam ID.');
            } finally {
                showLoading(false);
            }
        }

        function convertTo32BitId(steamId) {
            steamId = steamId.trim();
            if (steamId.length < 17) return steamId;
            try {
                const id64 = BigInt(steamId);
                return Number(id64 - 76561197960265728n).toString();
            } catch (e) {
                return steamId;
            }
        }

        function displayProfile() {
            if (playerData.profile) {
                document.getElementById('profileHeader').style.display = 'flex';
                document.getElementById('profileName').textContent = playerData.profile.personaname || 'Anonymous Hero';
                if (playerData.profile.avatarfull) {
                    document.getElementById('profileAvatar').style.backgroundImage = `url(${playerData.profile.avatarfull})`;
                    document.getElementById('profileAvatar').style.backgroundSize = 'cover';
                    document.getElementById('profileAvatar').textContent = '';
                }
            }
        }

        function displayStats(wl) {
            const total = wl.win + wl.lose;
            const winRate = total > 0 ? ((wl.win / total) * 100).toFixed(1) : 0;
            
            document.getElementById('totalMatches').textContent = total.toLocaleString();
            document.getElementById('winRate').textContent = winRate + '%';
            document.getElementById('winrateFill').style.width = winRate + '%';
            
            if (playerData.profile) {
                document.getElementById('profileMatches').textContent = total.toLocaleString();
                document.getElementById('profileWinrate').textContent = winRate + '%';
            }

            if (recentMatches.length > 0) {
                const avgK = recentMatches.reduce((s, m) => s + m.kills, 0) / recentMatches.length;
                const avgD = recentMatches.reduce((s, m) => s + m.deaths, 0) / recentMatches.length || 1;
                const avgA = recentMatches.reduce((s, m) => s + m.assists, 0) / recentMatches.length;
                const kda = ((avgK + avgA) / avgD).toFixed(2);
                
                document.getElementById('avgKDA').textContent = kda;
                document.getElementById('avgGPM').textContent = Math.round(
                    recentMatches.reduce((s, m) => s + m.gold_per_min, 0) / recentMatches.length
                );
                document.getElementById('avgXPM').textContent = Math.round(
                    recentMatches.reduce((s, m) => s + m.xp_per_min, 0) / recentMatches.length
                );

                const last10 = recentMatches.slice(0, 10);
                const recentWins = last10.filter(m => isWin(m)).length;
                document.getElementById('recentForm').textContent = `${recentWins}W - ${10 - recentWins}L`;
                
                // Calculate win streak
                let currentStreak = 0;
                let maxStreak = 0;
                for (const match of recentMatches) {
                    if (isWin(match)) {
                        currentStreak++;
                        maxStreak = Math.max(maxStreak, currentStreak);
                    } else {
                        currentStreak = 0;
                    }
                }
                document.getElementById('profileStreak').textContent = maxStreak;
            }
        }

        function displayRank() {
            let mmr = null;
            let rankTier = null;
            
            if (playerData.mmr_estimate && playerData.mmr_estimate.estimate) {
                mmr = playerData.mmr_estimate.estimate;
            } else if (playerData.rank_tier) {
                rankTier = playerData.rank_tier;
                const medal = Math.floor(rankTier / 10);
                const stars = rankTier % 10;
                mmr = (medal * 700) + (stars * 100);
            } else if (playerData.solo_competitive_rank) {
                mmr = playerData.solo_competitive_rank * 50;
            }

            if (mmr || rankTier) {
                document.getElementById('rankDisplay').style.display = 'block';
                
                let rank = 'Herald';
                let medal = '🥉';
                
                if (mmr >= 5420 || rankTier >= 70) { rank = 'Immortal'; medal = '🔥'; }
                else if (mmr >= 4620 || rankTier >= 60) { rank = 'Divine'; medal = '💎'; }
                else if (mmr >= 3850 || rankTier >= 50) { rank = 'Ancient'; medal = '⚔️'; }
                else if (mmr >= 3080 || rankTier >= 40) { rank = 'Legend'; medal = '⭐'; }
                else if (mmr >= 2310 || rankTier >= 30) { rank = 'Archon'; medal = '🏅'; }
                else if (mmr >= 1540 || rankTier >= 20) { rank = 'Crusader'; medal = '🗡️'; }
                else if (mmr >= 770 || rankTier >= 10) { rank = 'Guardian'; medal = '🛡️'; }

                document.getElementById('rankMedal').textContent = medal;
                document.getElementById('rankTitle').textContent = rank;
                document.getElementById('mmrValue').textContent = mmr ? `MMR: ~${Math.round(mmr)}` : 'Rank Tier: ' + rankTier;
            }
        }

        function displayHeroes() {
            const heroGrid = document.getElementById('heroGrid');
            heroGrid.innerHTML = '';

            const topHeroes = heroStats
                .filter(h => h.games > 0)
                .sort((a, b) => b.games - a.games)
                .slice(0, 20);

            topHeroes.forEach((hero, index) => {
                const winRate = ((hero.win / hero.games) * 100).toFixed(1);
                const card = document.createElement('div');
                card.className = 'hero-card';
                card.style.animationDelay = `${index * 0.05}s`;
                
                const heroIcon = getHeroIcon(hero.hero_id);
                const iconStyle = heroIcon ? `background-image: url(${heroIcon});` : '';
                
                card.innerHTML = `
                    <div class="hero-icon" style="${iconStyle}"></div>
                    <div class="hero-name">${heroNames[hero.hero_id] || 'Hero ' + hero.hero_id}</div>
                    <div class="hero-stats">${hero.games} games</div>
                    <div class="hero-winrate ${winRate >= 50 ? 'good' : 'bad'}">
                        ${winRate}% WR
                    </div>
                `;
                
                heroGrid.appendChild(card);
            });
        }

        function displayMatches() {
            const matchList = document.getElementById('matchList');
            matchList.innerHTML = '';

            recentMatches.slice(0, 20).forEach((match, index) => {
                const won = isWin(match);
                const card = document.createElement('div');
                card.className = `match-card ${won ? 'win' : 'loss'}`;
                card.style.animationDelay = `${index * 0.03}s`;
                
                const duration = `${Math.floor(match.duration / 60)}:${(match.duration % 60).toString().padStart(2, '0')}`;
                const heroIcon = getHeroIcon(match.hero_id);
                const iconStyle = heroIcon ? `background-image: url(${heroIcon});` : '';
                
                // Build items HTML - now we have the actual item data
                let itemsHtml = '<div class="match-items-container"><div class="match-items-main">';
                for (let i = 0; i < 6; i++) {
                    const itemId = match[`item_${i}`];
                    if (itemId && itemId !== 0) {
                        const itemIcon = getItemIcon(itemId);
                        if (itemIcon) {
                            itemsHtml += `<div class="item-slot" style="background-image: url(${itemIcon});" title="Item ${itemId}"></div>`;
                        } else {
                            itemsHtml += '<div class="item-slot empty"></div>';
                        }
                    } else {
                        itemsHtml += '<div class="item-slot empty"></div>';
                    }
                }
                itemsHtml += '</div>';
                
                // Neutral item
                if (match.item_neutral && match.item_neutral !== 0) {
                    const neutralIcon = getItemIcon(match.item_neutral);
                    if (neutralIcon) {
                        itemsHtml += `<div class="item-slot neutral" style="background-image: url(${neutralIcon});"></div>`;
                    }
                }
                itemsHtml += '</div>';
                
                // Calculate additional stats
                const kdaRatio = match.deaths > 0 ? ((match.kills + match.assists) / match.deaths).toFixed(1) : '∞';
                
                // Build team composition if we have detailed data
                let teamsHtml = '';
                if (match.details && match.details.players) {
                    const players = match.details.players;
                    const radiantPlayers = players.filter(p => p.player_slot < 128).sort((a, b) => a.player_slot - b.player_slot);
                    const direPlayers = players.filter(p => p.player_slot >= 128).sort((a, b) => a.player_slot - b.player_slot);
                    
                    teamsHtml = '<div class="match-teams">';
                    
                    // Radiant team
                    teamsHtml += '<div class="team-row radiant"><span class="team-label">RAD</span>';
                    radiantPlayers.forEach(p => {
                        const pHeroIcon = getHeroIcon(p.hero_id);
                        const isPlayer = p.account_id == currentAccountId;
                        teamsHtml += `<div class="team-hero ${isPlayer ? 'player' : ''}" 
                            style="background-image: url(${pHeroIcon});" 
                            title="${heroNames[p.hero_id] || 'Hero ' + p.hero_id}"></div>`;
                    });
                    teamsHtml += '</div>';
                    
                    // Dire team
                    teamsHtml += '<div class="team-row dire"><span class="team-label">DIRE</span>';
                    direPlayers.forEach(p => {
                        const pHeroIcon = getHeroIcon(p.hero_id);
                        const isPlayer = p.account_id == currentAccountId;
                        teamsHtml += `<div class="team-hero ${isPlayer ? 'player' : ''}" 
                            style="background-image: url(${pHeroIcon});" 
                            title="${heroNames[p.hero_id] || 'Hero ' + p.hero_id}"></div>`;
                    });
                    teamsHtml += '</div>';
                    
                    teamsHtml += '</div>';
                }
                
                card.innerHTML = `
                    <div class="match-hero">
                        <div class="match-hero-icon" style="${iconStyle}"></div>
                        <div class="match-hero-name">${heroNames[match.hero_id] || 'Hero'}</div>
                    </div>
                    <div class="match-details">
                        <div class="match-top-row">
                            <span class="match-result ${won ? 'win' : 'loss'}">${won ? 'WIN' : 'LOSS'}</span>
                            <div class="match-kda">
                                ${match.kills}<span>/</span>${match.deaths}<span>/</span>${match.assists}
                                <span class="kda-ratio">${kdaRatio}</span>
                            </div>
                        </div>
                        <div class="match-stats">
                            <div class="match-stat">
                                <span class="match-stat-label">GPM</span>
                                <span class="match-stat-value">${match.gold_per_min}</span>
                            </div>
                            <div class="match-stat">
                                <span class="match-stat-label">XPM</span>
                                <span class="match-stat-value">${match.xp_per_min}</span>
                            </div>
                            <div class="match-stat">
                                <span class="match-stat-label">CS</span>
                                <span class="match-stat-value">${match.last_hits || 0}/${match.denies || 0}</span>
                            </div>
                            <div class="match-stat">
                                <span class="match-stat-label">DMG</span>
                                <span class="match-stat-value">${formatNumber(match.hero_damage || 0)}</span>
                            </div>
                            <div class="match-stat">
                                <span class="match-stat-label">TWR</span>
                                <span class="match-stat-value">${formatNumber(match.tower_damage || 0)}</span>
                            </div>
                        </div>
                        ${itemsHtml}
                    </div>
                    ${teamsHtml}
                    <div class="match-meta">
                        <div>
                            <div class="match-duration">${duration}</div>
                            <div class="match-mode">${getGameMode(match.game_mode)}</div>
                            <div class="match-time">${getTimeAgo(match.start_time)}</div>
                        </div>
                        <div>
                            <div class="match-team-score">
                                <span class="radiant-score">${match.radiant_score || match.details?.radiant_score || '--'}</span>
                                <span class="score-separator">:</span>
                                <span class="dire-score">${match.dire_score || match.details?.dire_score || '--'}</span>
                            </div>
                            <a href="https://www.opendota.com/matches/${match.match_id}" target="_blank" class="match-link">Details →</a>
                        </div>
                    </div>
                `;
                
                matchList.appendChild(card);
            });
        }

        function formatNumber(num) {
            if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'k';
            }
            return num.toString();
        }

        function getSkillBracket(skill) {
            const brackets = {
                1: 'Normal',
                2: 'High',
                3: 'Very High'
            };
            return brackets[skill] || '';
        }

        function createCharts() {
            // Get canvas elements
            const perfCanvas = document.getElementById('performanceChart');
            const kdaCanvas = document.getElementById('kdaChart');
            const impactCanvas = document.getElementById('impactChart');
            
            // Set explicit dimensions for canvases
            perfCanvas.style.height = '300px';
            kdaCanvas.style.height = '300px';
            impactCanvas.style.height = '300px';
            
            const ctx1 = perfCanvas.getContext('2d');
            const ctx2 = kdaCanvas.getContext('2d');
            const ctx3 = impactCanvas.getContext('2d');

            const last20 = recentMatches.slice(0, 20).reverse();
            
            // Calculate cumulative win rate
            let wins = 0;
            const winRateData = last20.map((match, index) => {
                if (isWin(match)) wins++;
                return (wins / (index + 1)) * 100;
            });

            // KDA per game
            const kdaData = last20.map(match => {
                const deaths = match.deaths || 1;
                return ((match.kills + match.assists) / deaths);
            });

            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: { color: '#7c8184' }
                    }
                },
                scales: {
                    y: {
                        ticks: { color: '#7c8184' },
                        grid: { color: '#2e3338' }
                    },
                    x: {
                        ticks: { color: '#7c8184' },
                        grid: { color: '#2e3338' }
                    }
                }
            };

            new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: last20.map((_, i) => `Game ${i + 1}`),
                    datasets: [{
                        label: 'Win Rate %',
                        data: winRateData,
                        borderColor: '#d4af37',
                        backgroundColor: 'rgba(212, 175, 55, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: chartOptions
            });

            new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: last20.map((_, i) => `Game ${i + 1}`),
                    datasets: [{
                        label: 'KDA Ratio',
                        data: kdaData,
                        backgroundColor: last20.map(m => isWin(m) ? 'rgba(146, 165, 37, 0.6)' : 'rgba(194, 60, 42, 0.6)'),
                        borderColor: last20.map(m => isWin(m) ? '#92a525' : '#c23c2a'),
                        borderWidth: 2
                    }]
                },
                options: chartOptions
            });

            // Impact Chart
            const avgGPM = recentMatches.reduce((s, m) => s + m.gold_per_min, 0) / recentMatches.length;
            const avgXPM = recentMatches.reduce((s, m) => s + m.xp_per_min, 0) / recentMatches.length;
            const avgKills = recentMatches.reduce((s, m) => s + m.kills, 0) / recentMatches.length;
            const avgDeaths = recentMatches.reduce((s, m) => s + m.deaths, 0) / recentMatches.length;
            const avgAssists = recentMatches.reduce((s, m) => s + m.assists, 0) / recentMatches.length;

            new Chart(ctx3, {
                type: 'radar',
                data: {
                    labels: ['GPM', 'XPM', 'Kills', 'Deaths', 'Assists'],
                    datasets: [{
                        label: 'Average Performance',
                        data: [
                            Math.min((avgGPM / 500) * 100, 100),
                            Math.min((avgXPM / 600) * 100, 100),
                            Math.min((avgKills / 15) * 100, 100),
                            Math.max(0, 100 - (avgDeaths / 10) * 100),
                            Math.min((avgAssists / 20) * 100, 100)
                        ],
                        borderColor: '#d4af37',
                        backgroundColor: 'rgba(212, 175, 55, 0.2)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#7c8184' }
                        }
                    },
                    scales: {
                        r: {
                            ticks: { color: '#7c8184', backdropColor: 'transparent' },
                            grid: { color: '#2e3338' },
                            angleLines: { color: '#2e3338' },
                            pointLabels: { color: '#7c8184' }
                        }
                    }
                }
            });
        }

        function switchTab(event, tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function isWin(match) {
            return (match.player_slot < 128 && match.radiant_win) || 
                   (match.player_slot >= 128 && !match.radiant_win);
        }

        function getGameMode(mode) {
            const modes = {
                1: 'All Pick', 2: 'Captains Mode', 3: 'Random Draft',
                4: 'Single Draft', 5: 'All Random', 22: 'Ranked',
                23: 'Turbo', 12: 'Least Played', 14: 'Limited Heroes'
            };
            return modes[mode] || 'Custom';
        }

        function getTimeAgo(timestamp) {
            const diff = Date.now() / 1000 - timestamp;
            if (diff < 3600) return `${Math.floor(diff / 60)} mins ago`;
            if (diff < 86400) return `${Math.floor(diff / 3600)} hours ago`;
            if (diff < 604800) return `${Math.floor(diff / 86400)} days ago`;
            return `${Math.floor(diff / 604800)} weeks ago`;
        }

        function showLoading(show) {
            document.querySelector('.loading').classList.toggle('active', show);
        }

        function showError(msg) {
            const error = document.getElementById('error');
            error.textContent = msg;
            error.classList.add('active');
        }

        function hideError() {
            document.getElementById('error').classList.remove('active');
        }

        // Enter key support
        document.getElementById('steamId').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') fetchData();
        });
    </script>
</body>
</html>